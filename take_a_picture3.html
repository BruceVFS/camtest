<!DOCTYPE html>
<html>
<head>
  <title>Camera Access Example</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.3/css/bulma.min.css">
  <style>
    #camera-preview {
      width: 100%;
      height: auto;
    }
    #captured-picture {
      max-width: 100%;
      max-height: 100%;
      margin-top: 10px;
    }
    #metadata {
      margin-top: 10px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <section class="section">
    <div class="container">
      <h1 class="title">Camera Access Example</h1>
      <div class="columns">
        <div class="column">
          <div class="card">
            <div class="card-content">
              <h2 class="title is-4">Camera View</h2>
              <div class="card-image">
                <video id="camera-preview" autoplay></video>
              </div>
              <div class="card-footer">
                <button id="take-picture" class="button is-primary">Take Picture</button>
              </div>
            </div>
          </div>
        </div>
        <div class="column">
          <div class="card">
            <div class="card-content">
              <h2 class="title is-4">Captured Picture</h2>
              <div class="card-image">
                <img id="captured-picture">
              </div>
              <div id="metadata">Device Information</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Additional Dependencies -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/exif-js/2.3.0/exif.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fingerprintjs2/2.1.0/fingerprint2.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mobile-detect/1.4.6/mobile-detect.min.js"></script>

  <script>
    // Check if the browser supports the MediaDevices API
    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
      // Access the camera
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(function (stream) {
          var video = document.getElementById('camera-preview');
          // Set the video source to the camera stream
          video.srcObject = stream;
          // Play the video
          video.play();
        })
        .catch(function (error) {
          console.error('Error accessing the camera:', error);
        });
    } else {
      console.error('MediaDevices API not supported');
    }

    // Capture picture when the button is clicked
    var takePictureButton = document.getElementById('take-picture');
    takePictureButton.addEventListener('click', function () {
      var video = document.getElementById('camera-preview');
      var canvas = document.createElement('canvas');
      // Set canvas dimensions to match the video element
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      // Draw the video frame onto the canvas
      canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
      // Convert the canvas content to a data URL
      var pictureDataUrl = canvas.toDataURL();

      // Set the captured picture as the source for the image element
      var capturedPicture = document.getElementById('captured-picture');
      capturedPicture.src = pictureDataUrl;

      // Get the metadata of the picture
      var reader = new FileReader();
      reader.onload = function (e) {
        var buffer = e.target.result;
        var exifData = EXIF.readFromBinaryFile(buffer);

        // Use MobileDetect library to detect device information
        var md = new MobileDetect();
        var fingerprint;
        new Fingerprint2().get(function (result) {
          fingerprint = result;
          var metadataContainer = document.getElementById('metadata');
          var deviceInfo = {
            'User Agent': navigator.userAgent,
            'Screen Dimensions': {
              'Width': screen.width,
              'Height': screen.height
            },
            'Browser Information': {
              'Name': navigator.appName,
              'Version': navigator.appVersion,
              'Language': navigator.language
            },
            'Geolocation': {
              'Latitude': '',
              'Longitude': ''
            },
            'Device Orientation': '',
            'Network Information': {
              'Connection Type': navigator.connection ? navigator.connection.type : 'N/A',
              'Connection Speed': navigator.connection ? navigator.connection.downlink : 'N/A'
            },
            'Battery Status': {
              'Level': navigator.getBattery ? navigator.getBattery().level : 'N/A',
              'Charging': navigator.getBattery ? navigator.getBattery().charging : 'N/A'
            },
            'Device Information': {
              'Mobile': md.mobile(),
              'Tablet': md.tablet(),
              'Desktop': md.desktop(),
              'OS': md.os(),
              'Fingerprint': fingerprint
            }
          };

          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
              deviceInfo['Geolocation']['Latitude'] = position.coords.latitude;
              deviceInfo['Geolocation']['Longitude'] = position.coords.longitude;
              metadataContainer.innerHTML = JSON.stringify(deviceInfo, null, 2);
            }, function (error) {
              console.error('Error retrieving geolocation:', error);
              metadataContainer.innerHTML = JSON.stringify(deviceInfo, null, 2);
            });
          } else {
            metadataContainer.innerHTML = JSON.stringify(deviceInfo, null, 2);
          }
        });
      };
      reader.readAsArrayBuffer(capturedPicture.src);
    });
  </script>
</body>
</html>
