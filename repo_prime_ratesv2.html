<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repo Rate, Prime Lending Rate, and Exchange Rates</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        tr:nth-child(odd) {
            background-color: #f0f0f0;
        }
        tr:nth-child(even) {
            background-color: #f6f6f6;
        }
        .pastel-green td {
            background-color: #e8f4da;
        }
        .pastel-blue td {
            background-color: #dae8f4;
        }
        .center {
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">Repo Rate, Prime Lending Rate, and Exchange Rates</h1>
        <p>Query performed: <span id="lastUpdated"></span></p>
        <div class="table-responsive">
            <table class="table table-bordered">
                <thead class="thead-dark">
                    <tr>
                        <th>Name</th>
                        <th>Rate Type</th>
                        <th>Published Date</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody id="rateData">
                </tbody>
            </table>
        </div>

        <h2 class="mt-4">Additional XML Data</h2>
        <div class="table-responsive">
            <table class="table table-bordered">
                <thead class="thead-dark">
                    <tr>
                        <th>Category</th>
                        <th>Name</th>
                        <th>Date</th>
                        <th>Value</th>
                        <th>Trend</th>
                    </tr>
                </thead>
                <tbody id="xmlData">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        async function fetchData() {
            try {
                const currentDate = new Date();
                document.getElementById('lastUpdated').innerText = currentDate.toLocaleString('en-GB', { hour12: true, hour: 'numeric', minute: 'numeric', second: 'numeric', day: '2-digit', month: 'long', year: 'numeric' });

                // Fetch JSON data
                const [homePageRatesResponse, historicalRatesResponse] = await Promise.all([
                    fetch('https://custom.resbank.co.za/SarbWebApi/WebIndicators/HomePageRates'),
                    fetch('https://custom.resbank.co.za/SarbWebApi/WebIndicators/OtherIndicators/HistoricalDatesOfRateChanges/')
                ]);
                const [homePageRatesData, historicalRatesData] = await Promise.all([
                    homePageRatesResponse.json(),
                    historicalRatesResponse.json()
                ]);

                // Fetch XML data
                const xmlResponse = await fetch('https://example.com/inflation-rates.xml');
                const xmlText = await xmlResponse.text();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, "application/xml");

                // Parse XML data
                const xmlItems = Array.from(xmlDoc.querySelectorAll('item'));
                const xmlDataBody = document.getElementById('xmlData');

                xmlItems.forEach(item => {
                    const category = item.querySelector('category')?.textContent || 'N/A';
                    const name = item.querySelector('name')?.textContent || 'N/A';
                    const date = item.querySelector('date')?.textContent || 'N/A';
                    const value = item.querySelector('value')?.textContent || 'N/A';
                    const trend = item.querySelector('trend')?.textContent || 'N/A';

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${category}</td>
                        <td>${name}</td>
                        <td>${new Date(date).toLocaleDateString('en-GB', { day: '2-digit', month: 'long', year: 'numeric' })}</td>
                        <td>${value}</td>
                        <td>${trend === '1' ? 'Up' : trend === '-1' ? 'Down' : 'No Change'}</td>
                    `;
                    xmlDataBody.appendChild(row);
                });

                // Populate JSON data table
                const tableBody = document.getElementById('rateData');
                function createRow(name, rateType, date, value, isPastelGreen, isPastelBlue) {
                    const formattedDate = new Date(date).toLocaleDateString('en-GB', { day: '2-digit', month: 'long', year: 'numeric' });
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${name}</td>
                        <td>${rateType}</td>
                        <td>${formattedDate}</td>
                        <td>${value}</td>
                    `;
                    if (isPastelGreen) row.classList.add('pastel-green');
                    if (isPastelBlue) row.classList.add('pastel-blue');
                    return row;
                }

                const repoRateData = homePageRatesData.find(rate => rate.Name === 'Repo rate');
                const primeLendingRateData = homePageRatesData.find(rate => rate.Name === 'Prime lending rate');
                tableBody.appendChild(createRow(repoRateData.Name, 'Repurchase rate', repoRateData.Date, repoRateData.Value, true, false));
                tableBody.appendChild(createRow(primeLendingRateData.Name, 'Prime lending rate', primeLendingRateData.Date, primeLendingRateData.Value, true, false));
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('rateData').innerHTML = '<tr><td colspan="4">Error fetching data</td></tr>';
                document.getElementById('xmlData').innerHTML = '<tr><td colspan="5">Error fetching XML data</td></tr>';
            }
        }

        window.onload = fetchData;
    </script>
</body>
</html>
