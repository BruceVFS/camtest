<!DOCTYPE html>
<html>
<head>
  <title>T.A.C. Search</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
  <style>
    /* Existing styles */
    .highlight {
      background-color: yellow;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="title is-4">T.A.C. Search</h1>
    <div class="field has-addons search-input">
      <div class="control">
        <input class="input" type="text" id="searchInput" placeholder="Enter search text" onkeyup="handleSearchInput()">
      </div>
      <div class="control">
        <button class="button is-danger" onclick="clearSearch()" id="clearButton">Clear</button>
      </div>
      <div class="control">
        <button class="button is-primary" onclick="searchDatabase()">Search</button>
      </div>
    </div>
    <div class="search-results" id="searchResults"></div>
  </div>

  <script>
    function handleSearchInput() {
      const searchInput = document.getElementById('searchInput');
      const clearButton = document.getElementById('clearButton');

      if (searchInput.value.length > 0) {
        clearButton.classList.remove('is-hidden');
      } else {
        clearButton.classList.add('is-hidden');
      }

      if (searchInput.value.length >= 3) {
        searchDatabase();
      }
    }

    function searchDatabase() {
      const searchInput = document.getElementById('searchInput');
      const searchText = searchInput.value.toLowerCase();

      const xhr = new XMLHttpRequest();
      xhr.onreadystatechange = function() {
        if (xhr.readyState === XMLHttpRequest.DONE) {
          if (xhr.status === 200) {
            const response = JSON.parse(xhr.responseText);

            if (response.success) {
              const results = response.data;
              displayResults(results, searchText);
            } else {
              console.error('Failed to fetch data from the database.');
            }
          } else {
            console.error('Failed to fetch data from the database.');
          }
        }
      };

      // Replace with your server-side script to fetch data from the database
      xhr.open('POST', 'fetch_data.php', true);
      xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
      xhr.send(`searchText=${searchText}`);
    }

    function displayResults(results, searchText) {
      // Display search results
      const searchResults = document.getElementById('searchResults');
      let html = '';
      if (results.length > 0) {
        html = '<table border="1"><tr>';
        Object.keys(results[0]).forEach(key => {
          html += `<th>${key}</th>`;
        });
        html += '</tr>';

        results.forEach(result => {
          html += '<tr>';
          Object.entries(result).forEach(([key, value]) => {
            const highlightedValue = value.replace(new RegExp(searchText, 'gi'), match => `<span class="highlight">${match}</span>`);
            html += `<td>${highlightedValue}</td>`;
          });
          html += '</tr>';
        });

        html += '</table>';
      } else {
        html = '<p>No results found.</p>';
      }

      searchResults.innerHTML = html;
    }

    function clearSearch() {
      const searchInput = document.getElementById('searchInput');
      searchInput.value = '';
      const clearButton = document.getElementById('clearButton');
      clearButton.classList.add('is-hidden');
      const searchResults = document.getElementById('searchResults');
      searchResults.innerHTML = '';
    }
  </script>
</body>
</html>
